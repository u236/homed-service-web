'use strict';'require view';'require fs';'require ui';var isReadonlyView=!L.hasViewPermission()||null;var homedPort=8080;function getHomedPort(configuration){var section;configuration.split(/[\r\n]+/).forEach(function(line){if(/^\s*([^=;]+?)\s*=\s*(.*?)\s*$/.test(line)){var match=line.match(/^\s*([^=;]+?)\s*=\s*(.*?)\s*$/);if(section=='server'&&match[1]=='port'){homedPort=match[2];}}else if(/^\s*\[\s*([^\]]*)\s*\]\s*$/.test(line)){var match=line.match(/^\s*\[\s*([^\]]*)\s*\]\s*$/);section=match[1];};});}function getHomedLink(configuration){getHomedPort(configuration);return location.protocol+'//'+location.host+':'+homedPort+'/';}return view.extend({load:function(){return L.resolveDefault(fs.read('/etc/homed/homed-web.conf'),'');},handleSave:function(ev){var value=(document.querySelector('textarea').value||'');return fs.write('/etc/homed/homed-web.conf',value).then(function(rc){document.querySelector('textarea').value=value;document.querySelector('#homedLink').href=getHomedLink(value);ui.addNotification(null,E('p',_('Configuration have been succesfully saved!')),'info');}).catch(function(e){ui.addNotification(null,E('p',_('Unable to save configuration: %s').format(e.message)));});},render:function(configuration){getHomedPort(configuration);return E([E('h2',_('HOMEd Web Service Configuration')),E('p',{'class':'cbi-section-descr'},_('Documentation can be found <a href="https://wiki.homed.dev/web/configuration" target="_blank">here</a>.' + (homedPort?'<br><a id="homedLink" href="'+getHomedLink(configuration)+'" target="_blank">Open</a> HOMEd Web.':''))),E('p',{},E('textarea',{'style':'width:100%','rows':25,'disabled':isReadonlyView},[configuration!=null?configuration:'']))]);},handleSaveApply:null,handleReset:null});
